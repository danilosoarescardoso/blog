<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">

    <meta name="author" content="Danilo Soares Frois Cardoso">


    <meta name="subtitle" content="Desenvolvimento Web e amenidades">


    <meta name="description" content="Aqui falo sobre tecnologia e muitas amenidades.">





<title>Autenticando APIs com HMAC | Blog do Frois</title>



    <link rel="icon" href="/favicon.ico">



<style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Noto+Sans+SC:wght@300;400;500;700&family=Roboto+Mono&display=swap');
</style>



    <!-- stylesheets list from _config.yml -->
    
    <link rel="stylesheet" href="/css/style.css">
    




    <!-- scripts list from _config.yml -->
    
    <script src="/js/menu.js"></script>
    










  <meta name="generator" content="Hexo 5.4.2"></head>
  <body>
    <div class="mask-border">
    </div>

    <div class="wrapper">

      <div class="header">
  <div class="flex-container">
    <div class="header-inner">
      <div class="site-brand-container">
        <a href="/">
          
            Blog do Frois.
          
        </a>
      </div>
      <div id="menu-btn" class="menu-btn" onclick="toggleMenu()">
        Menu
      </div>
      <nav class="site-nav">
        <ul class="menu-list">
          
            
              <li class="menu-item">
                <a href="/">Home</a>
              </li> 
                   
          
            
              <li class="menu-item">
                <a href="/archives/">Posts</a>
              </li> 
                   
          
          
        </ul>
      </nav>
    </div>
  </div>
</div>
<script src="/js/menu.js"></script>


      <div class="main">
        <div class="flex-container">
          <article id="post">

  
    <div class="post-head">
    <div class="post-info">
        <div class="tag-list">
            
                
                    <span class="post-tag">
                        <a href="/tags/apis/">
                            apis
                        </a>
                    </span>    
                
                    <span class="post-tag">
                        <a href="/tags/2023/">
                            2023
                        </a>
                    </span>    
                
                    <span class="post-tag">
                        <a href="/tags/seguranca/">
                            segurança
                        </a>
                    </span>    
                
                    <span class="post-tag">
                        <a href="/tags/hmac/">
                            hmac
                        </a>
                    </span>    
                
                    <span class="post-tag">
                        <a href="/tags/arquitetura/">
                            arquitetura
                        </a>
                    </span>    
                           
            
        </div>
        <div class="post-title">
            
            
                Autenticando APIs com HMAC
            
            
        </div>
        <span class="post-date">
            ago 6, 2023
        </span>
    </div>
    <div class="post-img">
        
            <div class="h-line-primary"></div>
              
    </div>
</div>
    <div class="post-content">
    <p>Recentemente estava estudando sobre como funciona a autenticação de APIs usando HMAC e resolvi fazer um texto explicando sobre como esse modelo de segurança para APIs opera, trazendo seus prós, contras e indicações de uso.</p>
<h2 id="O-que-e-HMAC"><a href="#O-que-e-HMAC" class="headerlink" title="O que é HMAC"></a>O que é HMAC</h2><p>Dentro da área de segurança da informação, um MAC é considerado um ** código autenticador de mensagem** - o termo significa <em>message authentication code</em> em inglês. Geralmente um algoritmo de criptografia MAC recebe uma chave secreta - que pode ser qualquer série de caracteres - e uma mensagem que será autenticada. O resultado do processamento da mensagem com a chave secreta é uma <em>string</em> única que será enviada para o consumidor dessa mensagem, junto com a mensagem original. </p>
<p>Para que o consumidor valide a integridade da mensagem recebida, ele deverá receber previamente a chave secreta e qual algoritmo de criptografia que foi utilizado para gerar o hash.</p>
<h2 id="HMAC-em-APIs"><a href="#HMAC-em-APIs" class="headerlink" title="HMAC em APIs"></a>HMAC em APIs</h2><p>No mundo de APIs, esse processo de gerar uma <em>string</em> e enviar para os consumidores é conhecido como HMAC, ou <em>Hash-based message authentication code</em> em inglês - <strong>código de autenticação de mensagem baseado em Hash</strong> em português. Sabe quando você precisa de um token pra usar uma API? Então, existem várias formas de obter e gerar tokens. Na autenticação HMAC, o token a ser utilizado para validar a autenticidade da mensagem e do seu emissor é feito utilizando essa string. Agora vamos ver como essa validação é feita.</p>
<h2 id="Como-funciona-a-validacao-no-HMAC"><a href="#Como-funciona-a-validacao-no-HMAC" class="headerlink" title="Como funciona a validação no HMAC"></a>Como funciona a validação no HMAC</h2><p>Com HMAC, ao invés de você enviar um token OAuth, com escopos, permissões e informações do remetente, o token enviado é a hash que expliquei anteriormente. A ideia desse token não é a de garantir a autenticidade do remetente, mas sim garantir que a mensagem recebida está consistente com o que foi enviado pelo remetente. Até existem casos de uso onde OAuth e HMAC são combinados, mas não existe uma obrigatoriedade. </p>
<p>Como dito anteriormente, a hash é enviada junto com a mensagem para validação. Quando a mensagem é recebida, o destinatário já deve ter a chave secreta em mãos para cifrar a mensagem. Com isso ele vai gerar uma nova hash e compará-la com a hash recebida na requisição. Se as duas forem iguais, ele aceita a mensagem. Se não, a descarta.</p>
<p>Na imagem abaixo o fluxo é descrito de forma visual para facilitar o entendimento:</p>
<img src="/blog/autenticando-apis-com-hmac/hmac-auth.drawio.png" class="">

<h2 id="Consideracoes-sobre-a-autenticacao-HMAC"><a href="#Consideracoes-sobre-a-autenticacao-HMAC" class="headerlink" title="Considerações sobre a autenticação HMAC"></a>Considerações sobre a autenticação HMAC</h2><p>Apesar de ser uma alternativa à autenticação OAuth, tenho algumas considerações a serem feitas na hora de usar algo como HMAC:</p>
<ul>
<li><strong>Gestão de chaves</strong>. Para que haja uma boa governança do processo de autenticação HMAC, é necessário gerenciar de maneira eficiente as diferentes chaves a serem compartilhadas com seus parceiros. Diferente de uma autenticação OAuth 2.0 que possui um ator somente para fazer isso - o servidor de autenticação - trabalhar com HMAC demanda a gestão dessas chaves por conta própria. Pelo menos não encontrei nos meus estudos uma ferramenta de autenticação que faça a gestão das chaves por default.</li>
<li><strong>Não possui confidencialidade</strong>. Diferente de OAuth onde podemos usar métodos de autenticação como o jwt-bearer, que encripta o payload para evitar vazamento de informações confidenciais, por exemplo, no HMAC a mensagem vai do jeito que ela foi escrita. A ideia do HMAC não é aumentar a confidencialidade, mas sim garantir a integridade da mensagem escrita pelo remetente. </li>
<li><strong>Sobrecarga de desempenho</strong>. Trabalhar com algoritmos de criptografia, apesar de aumentar a segurança de suas aplicações, gera maior necessidade de processamento computacional. Em transanções em tempo real (RT) ou quase em tempo real (NRT) isso pode ser um baita problema. É necessário levar esse ponto em consideração.</li>
<li><strong>Não garante a autenticidade do remetente</strong>. Apesar de haver uma chave secreta compartilhada apenas entre remetente e destinatário, não é possível garantir que o remetente é realmente quem esperamos que ele seja no HMAC. Isso porque qualquer atacante pode tomar conta de uma chave secreta e se passar pelo remetente. Nesse caso autenticações com certificado digital ou fluxo de <em>client credentials</em> ajudam a aumentar a segurança de suas APIs, garantindo que o remetente é realmente quem ele diz ser.</li>
</ul>
<p>Apesar desses pontos, existem algumas características quem podem fazer o HMAC ser útil na sua estratégia de APIs em determinados casos de uso, como por exemplo:</p>
<ul>
<li><strong>Camada adicional contra ataques DDoS</strong>. Uma das formas de implementar HMAC é incluindo o timestamp do momento da requisição. Com isso, apenas uma requisição será aceita pelo servidor caso todas as informações estejam certas, já que as subsequentes requisições em DDoS terão timestamps diferentes.</li>
<li><strong>Garantia de integridade do payload</strong>. Podem haver casos de uso específicos onde garantir a não alteração do payload durante a sua transmissão seja importante. No meu ponto de vista, isso pode ser adicionado como camada adicional de segurança em um fluxo OAuth 2.0 desde que haja o conhecido risco de um payload ser modificado.</li>
</ul>

</div> 

<script>
    window.onload = detectors();
</script>
    <div class="post-footer">
    <div class="h-line-primary"></div>
    <nav class="post-nav">
        <div class="prev-item">
           
                <div class="icon arrow-left"></div>
                <div class="post-link">
                    <a href="/integrando-sistemas-com-kafka-introducao/">Prev</a>
                </div>
            
        </div>
        <div class="next-item">
            
                <div class="icon arrow-right"></div>
                <div class="post-link">
                  <a href="/api-design-first-definindo-capacidades-digitais/">Next</a>  
                </div>  
            
        </div>
    </nav>
</div>

    
      <div class="post-comment">

     

     
    
    

</div>
     
  
</article>
        </div>
      </div>
      
      <div class="footer">
    <div class="flex-container">
        <div class="footer-text">
            
            
            
                Powered by <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a> & <a target="_blank" rel="noopener" href="https://github.com/zoeingwingkei/frame/">Frame</a>
                
        </div>
    </div>
</div>

    </div>

    
    

  </body>
</html>
